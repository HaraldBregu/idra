services:
  builder:
    image: golang:1.23-alpine
    working_dir: /src
    volumes:
      - .:/src
      - go-cache:/go/pkg/mod
    command: sh -c "CGO_ENABLED=0 go build -ldflags '-s -w' -o /src/idra ./cmd/idra"

  dev:
    image: golang:1.23-alpine
    working_dir: /src
    volumes:
      - .:/src
      - go-cache:/go/pkg/mod
    ports:
      - "127.0.0.1:8080:8080"
    command: go run ./cmd/idra run
    environment:
      - HOME=/tmp

volumes:
  go-cache:
